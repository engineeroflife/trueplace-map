<!DOCTYPE html>
<html>
<head>
  <title>True Place Gifts Map</title>
  <meta charset="utf-8" />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .layout {
      display: flex;
      height: 100vh;
      width: 100vw;
      position: relative;
    }

    #sidebar {
      width: 310px;
      max-width: 40vw;
      background: #ffffff;
      border-right: 1px solid #e2e8f0;
      box-shadow: 0 0 16px rgba(15, 23, 42, 0.08);
      padding: 16px 14px;
      overflow-y: auto;
      z-index: 500;
    }

    #sidebar h1 {
      font-size: 18px;
      margin: 0 0 10px 2px;
    }

    .story-item {
      display: flex;
      gap: 10px;
      padding: 8px;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s, box-shadow 0.1s;
    }

    .story-item:hover {
      background: #f1f5f9;
      transform: translateY(-1px);
      box-shadow: 0 1px 4px rgba(15, 23, 42, 0.12);
    }

    .story-item.active {
      background: #e0f7ee;
      box-shadow: 0 0 0 1px #22c55e inset;
    }

    .story-thumb {
      width: 54px;
      height: 54px;
      border-radius: 9px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .story-text {
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 2px;
    }

    .story-title {
      font-size: 14px;
      font-weight: 600;
      line-height: 1.2;
    }

    .story-subtitle {
      font-size: 12px;
      color: #64748b;
    }

    #map {
      flex: 1;
      height: 100%;
      width: 100%;
      z-index: 100;
    }

    /* Bea helper */
    #bea-helper {
      position: fixed;
      bottom: 20px;
      left: 24px;
      z-index: 900;
      cursor: pointer;
      display: flex;
      align-items: flex-end;
      gap: 8px;
    }

    #bea-img {
      height: 120px;
      transition: transform 0.2s ease;
    }

    #bea-helper:hover #bea-img {
      transform: scale(1.06);
    }

    #bea-bubble {
      background: #ffffff;
      border-radius: 14px;
      padding: 8px 10px;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.18);
      font-size: 12px;
      max-width: 220px;
      line-height: 1.3;
    }

    /* ⭐ Highlight glow */
    .highlighted-overlay {
      filter: drop-shadow(0 0 6px #39d98a)
              drop-shadow(0 0 10px #39d98a)
              drop-shadow(0 0 14px #39d98a);
    }

    @media (max-width: 768px) {
      .layout {
        flex-direction: column;
      }
      #sidebar {
        width: 100%;
        max-width: 100%;
        border-right: none;
        border-bottom: 1px solid #e2e8f0;
      }
      #map {
        height: calc(100vh - 180px);
      }
      #bea-helper {
        left: 12px;
        bottom: 12px;
      }
      #bea-img {
        height: 100px;
      }
      #bea-bubble {
        max-width: 180px;
      }
    }
  </style>
</head>

<body>

<div class="layout">
  <div id="sidebar">
    <h1>True Place Stories</h1>
    <div id="story-list"></div>
  </div>
  <div id="map"></div>
</div>

<!-- Bea the Otter helper -->
<div id="bea-helper">
  <img
    id="bea-img"
    src="https://raw.githubusercontent.com/engineeroflife/trueplace-map/main/Otter_BEa_nov25_1.webp"
    alt="Bea the Otter"
  />
  <div id="bea-bubble">
    Hi, I’m Bea! Tap any green lens on the map to explore a story from that place.
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  // --- Base map ----------------------------------------------------------

  const initialCenter = [30.0, -80.0];
  const map = L.map('map').setView(initialCenter, 6);

  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="https://carto.com/">CARTO</a>'
  }).addTo(map);

  // --- Story data --------------------------------------------------------

  const stories = [
    {
      id: 'windover',
      title: 'From the Ice Age to the Space Age in Brevard County, FL',
      subtitle: 'Windover People · Titusville, FL',
      lat: 28.613,
      lng: -80.807,
      delta: 0.08,
      link: 'https://trueplacegifts.com', 
      thumb: 'https://raw.githubusercontent.com/engineeroflife/trueplace-map/main/windover.jpg'
    },
    {
      id: 'flip-coin',
      title: 'The Coin That Flips the Super Bowl',
      subtitle: 'The Highland Mint · Melbourne, FL',
      lat: 28.0836,
      lng: -80.6081,
      delta: 0.08,
      link: 'https://trueplacegifts.com', 
      thumb: 'https://raw.githubusercontent.com/engineeroflife/trueplace-map/main/FlipCoin.jpg'
    },
    {
      id: 'space-ice-cream',
      title: 'The Ice Cream That Wanted to Go to Space',
      subtitle: 'Space Coast · Kennedy Space Center, FL',
      lat: 28.5729,
      lng: -80.6490,
      delta: 0.08,
      link: 'https://trueplacegifts.com', 
      thumb: 'https://raw.githubusercontent.com/engineeroflife/trueplace-map/main/icecream.jpg'
    },
    {
      id: 'tom-thumb',
      title: 'One of America’s First Global Celebrities – General Tom Thumb',
      subtitle: 'Middleborough, Massachusetts',
      lat: 41.8934,
      lng: -70.9112,
      delta: 0.4,
      link: 'https://trueplacegifts.com', 
      thumb: 'https://raw.githubusercontent.com/engineeroflife/trueplace-map/main/TomThumb.jpg'
    }
  ];

  const LENS_ICON_URL =
    'https://raw.githubusercontent.com/engineeroflife/trueplace-map/main/magnifying_gift_icon_green_transparent.png';

  const storyOverlays = {};

  // --- Create scaling overlays + highlight support -----------------------

  stories.forEach(story => {
    const center = [story.lat, story.lng];
    const delta = story.delta;

    const bounds = L.latLngBounds(
      [center[0] + delta, center[1] - delta],
      [center[0] - delta, center[1] + delta]
    );

    const overlay = L.imageOverlay(
      LENS_ICON_URL,
      bounds,
      { interactive: true }
    ).addTo(map);

    overlay.on('click', () => window.open(story.link, '_blank'));

    storyOverlays[story.id] = { overlay, center };
  });

  // --- Boundary layers ---------------------------------------------------

  // US states
  fetch('https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json')
    .then(r => r.json())
    .then(g => L.geoJSON(g, {
      style: {
        color: '#8aa0a5',
        weight: 1,
        opacity: 0.5,
        fillOpacity: 0
      }
    }).addTo(map));

  // Florida counties (WORKING URL)
  fetch('https://raw.githubusercontent.com/codeforgermany/click_that_hood/master/public/data/florida-counties.geojson')
    .then(r => r.json())
    .then(g => L.geoJSON(g, {
      style: {
        color: '#5bb388',
        weight: 1.2,
        opacity: 0.8,
        fillOpacity: 0
      }
    }).addTo(map));

  // --- Sidebar + story selection ----------------------------------------

  const listEl = document.getElementById('story-list');

  function setActiveStory(id) {
    document.querySelectorAll('.story-item').forEach(el =>
      el.classList.toggle('active', el.dataset.id === id)
    );
  }

  // ⭐ Highlight selected lens
  function highlightSelectedOverlay(selectedId) {
    Object.values(storyOverlays).forEach(({ overlay }) => {
      overlay.getElement()?.classList.remove('highlighted-overlay');
    });

    storyOverlays[selectedId].overlay.getElement()?.classList.add('highlighted-overlay');
  }

  stories.forEach((story, index) => {
    const item = document.createElement('div');
    item.className = 'story-item';
    item.dataset.id = story.id;

    item.innerHTML = `
      <img class="story-thumb" src="${story.thumb}" alt="${story.title}">
      <div class="story-text">
        <div class="story-title">${story.title}</div>
        <div class="story-subtitle">${story.subtitle}</div>
      </div>
    `;

    item.addEventListener('click', () => {
      const info = storyOverlays[story.id];
      if (!info) return;

      highlightSelectedOverlay(story.id);
      setActiveStory(story.id);

      map.flyTo(info.center, story.id === 'tom-thumb' ? 7 : 9, {
        duration: 0.9
      });
    });

    listEl.appendChild(item);

    if (index === 0) {
      setActiveStory(story.id);
    }
  });

  // Start centered roughly over Florida
  map.setView([28.5, -80.7], 7);

  // Bea helper
  document.getElementById('bea-helper').addEventListener('click', () => {
    map.flyTo([28.5, -80.7], 7, { duration: 1.0 });
  });
</script>

</body>
</html>
