<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>True Place Gifts Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

  <style>
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      overflow: hidden;
    }

    /* Sidebar */
    #sidebar {
      width: 290px;
      background: #ffffff;
      border-right: 1px solid #e2e8f0;
      padding: 10px;
      overflow-y: auto;
      box-shadow: 0 0 14px rgba(15, 23, 42, 0.12);
      z-index: 500;
    }

    #sidebar h2 {
      margin: 4px 4px 10px;
      font-size: 18px;
    }

    .story-item {
      display: flex;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.16s, transform 0.12s, box-shadow 0.12s;
      align-items: center;
    }

    .story-item:hover {
      background: #f1f5f9;
      transform: translateY(-1px);
      box-shadow: 0 1px 4px rgba(15, 23, 42, 0.15);
    }

    .story-item.active {
      background: #e0fbea;
      border-left: 4px solid #22c55e;
    }

    .story-thumb {
      width: 48px;
      height: 48px;
      margin-right: 10px;
      border-radius: 8px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .story-text-title {
      font-size: 13px;
      font-weight: 600;
      line-height: 1.25;
    }

    .story-text-sub {
      font-size: 12px;
      color: #64748b;
      margin-top: 2px;
    }

    /* Map */
    #map {
      flex: 1;
      height: 100%;
      width: 100%;
    }

    /* Bea bubble */
    #bea-message {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: flex;
      align-items: flex-end;
      z-index: 900;
    }

    #bea-img {
      width: 95px;
      margin-right: 10px;
    }

    #bea-text {
      background: white;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #cbd5e1;
      width: 220px;
      font-size: 13px;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.28);
    }

    /* --- Marker pointer fixes (important!) --- */
    .tp-marker {
      pointer-events: auto;
      cursor: pointer;
    }
    .tp-marker-inner,
    .tp-marker-plus {
      pointer-events: none;
    }

    /* Tiny custom marker (12px) */
    .tp-marker.leaflet-div-icon {
      background: transparent;
      border: none;
    }

    .tp-marker-inner {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #39A96B;
      border: 2px solid #1F7A47;
      box-sizing: content-box;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tp-marker-plus {
      width: 6px;
      height: 6px;
      position: relative;
    }

    .tp-marker-plus::before,
    .tp-marker-plus::after {
      content: "";
      position: absolute;
      background: #ffffff;
      border-radius: 1px;
    }

    .tp-marker-plus::before {
      width: 2px;
      height: 6px;
      left: 2px;
      top: 0;
    }

    .tp-marker-plus::after {
      width: 6px;
      height: 2px;
      left: 0;
      top: 2px;
    }

    /* Active marker glow */
    .tp-marker-active .tp-marker-inner {
      box-shadow:
        0 0 6px rgba(34, 197, 94, 0.9),
        0 0 10px rgba(34, 197, 94, 0.7);
      animation: tpPulse 0.9s ease-out 0s 2;
      transform: scale(1.4);
    }

    @keyframes tpPulse {
      0% {
        transform: scale(1.0);
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.8);
      }
      50% {
        transform: scale(1.45);
        box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.0);
      }
      100% {
        transform: scale(1.4);
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.0);
      }
    }

    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      #sidebar {
        width: 100%;
        height: 210px;
        box-shadow: 0 4px 12px rgba(15, 23, 42, 0.18);
      }
      #map {
        height: calc(100vh - 210px);
      }
      #bea-message {
        left: 10px;
        bottom: 10px;
      }
      #bea-img {
        width: 80px;
      }
      #bea-text {
        width: 190px;
      }
    }
  </style>
</head>
<body>

<!-- SIDEBAR -->
<div id="sidebar">
  <h2>True Place Stories</h2>

  <div class="story-item" data-id="iceage">
    <img class="story-thumb" src="windover.jpg" alt="Windover People">
    <div>
      <div class="story-text-title">From the Ice Age to the Space Age</div>
      <div class="story-text-sub">Windover People · Titusville, FL</div>
    </div>
  </div>

  <div class="story-item" data-id="flipcoin">
    <img class="story-thumb" src="FlipCoin.jpg" alt="Flip Coin Story">
    <div>
      <div class="story-text-title">The Coin That Flips the Super Bowl</div>
      <div class="story-text-sub">The Highland Mint · Melbourne, FL</div>
    </div>
  </div>

  <div class="story-item" data-id="icecream">
    <img class="story-thumb" src="icecream.jpg" alt="Space Ice Cream Story">
    <div>
      <div class="story-text-title">The Ice Cream That Wanted to Go to Space</div>
      <div class="story-text-sub">Kennedy Space Center, FL</div>
    </div>
  </div>

  <div class="story-item" data-id="tomthumb">
    <img class="story-thumb" src="TomThumb.jpg" alt="Tom Thumb Story">
    <div>
      <div class="story-text-title">General Tom Thumb</div>
      <div class="story-text-sub">Middleborough, MA</div>
    </div>
  </div>
</div>

<!-- MAP -->
<div id="map"></div>

<!-- BEA -->
<div id="bea-message">
  <img id="bea-img" src="Otter_BEa_nov25_1.webp" alt="Bea the Otter">
  <div id="bea-text">
    Hi, I'm Bea! Tap any green lens on the map to explore a story from that place.
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  /* ---- STORIES WITH URLS ---- */
  const stories = [
    {
      id: "iceage",
      coords: [28.613, -80.807],
      zoom: 11,
      url: "https://trueplacegifts.com/blogs/stories/windover-people"
    },
    {
      id: "flipcoin",
      coords: [28.083, -80.608],
      zoom: 11,
      url: "https://trueplacegifts.com/blogs/stories/the-coin-that-flips-the-super-bowl"
    },
    {
      id: "icecream",
      coords: [28.573, -80.646],
      zoom: 11,
      url: "https://trueplacegifts.com/blogs/stories/the-ice-cream-that-wanted-to-go-to-space"
    },
    {
      id: "tomthumb",
      coords: [41.893, -70.910],
      zoom: 13,
      url: "https://trueplacegifts.com/blogs/stories/general-tom-thumb-middleborough"
    }
  ];

  // ---- Map setup ----
  const map = L.map('map').setView([28.3, -81.2], 7);

  L.tileLayer(
    'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png',
    {
      maxZoom: 19,
      attribution:
        '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> ' +
        '&copy; <a href="https://carto.com/attributions">CARTO</a>'
    }
  ).addTo(map);

  // ---- Custom tiny marker icon ----
  const tpIcon = L.divIcon({
    className: 'tp-marker',
    html: '<div class="tp-marker-inner"><div class="tp-marker-plus"></div></div>',
    iconSize: [12, 12],
    iconAnchor: [6, 6]
  });

  // ---- Create markers ----
 stories.forEach(story => {
    const marker = L.marker(story.coords, { icon: tpIcon }).addTo(map);

    /* CLICK OPENS SHOPIFY STORY */
    marker.on("click", () => {

        console.log("MARKER CLICKED:", story.id);   // <<< ADD THIS LINE
window.top.location.href = story.url;
    });

    markers[story.id] = marker;
});


  // ---- Highlight + zoom ----
  function highlightStory(id) {
    document.querySelectorAll('.story-item').forEach(el => {
      el.classList.toggle('active', el.dataset.id === id);
    });

    stories.forEach(story => {
      const m = markers[story.id];
      const el = m.getElement();
      if (!el) return;
      if (story.id === id) {
        el.classList.add('tp-marker-active');
        m.setZIndexOffset(1000);
      } else {
        el.classList.remove('tp-marker-active');
        m.setZIndexOffset(0);
      }
    });

    const s = stories.find(st => st.id === id);
    if (s) map.flyTo(s.coords, s.zoom, { duration: 0.8 });
  }

  // Sidebar clicks ALSO open stories
  document.querySelectorAll('.story-item').forEach(item => {
    item.addEventListener('click', () => {
      const id = item.dataset.id;
      highlightStory(id);
      const story = stories.find(s => s.id === id);
      window.location.href = story.url;
    });
  });

  // Initial view
  map.setView([28.5, -80.7], 7);
  highlightStory('iceage');
</script>

</body>
</html>
