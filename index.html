<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>True Place Gifts Map</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

  <style>
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }

    /* Sidebar */
    #sidebar {
      width: 290px;
      background: #ffffff;
      border-right: 1px solid #ddd;
      padding: 10px;
      overflow-y: auto;
    }

    #sidebar h2 {
      margin-top: 0;
      margin-bottom: 10px;
    }

    .story-item {
      display: flex;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
      align-items: center;
    }

    .story-item:hover {
      background: #f2f6ff;
    }

    .story-item.active {
      background: #dff5e1;
      border-left: 5px solid #31a354;
    }

    .story-thumb {
      width: 48px;
      height: 48px;
      margin-right: 10px;
      border-radius: 6px;
      object-fit: cover;
    }

    #map {
      flex: 1;
      height: 100%;
      width: 100%;
    }

    /* Bea Bubble */
    #bea-message {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: flex;
      align-items: flex-end;
      z-index: 999;
    }

    #bea-img {
      width: 95px;
      margin-right: 10px;
    }

    #bea-text {
      background: white;
      padding: 12px 15px;
      border-radius: 10px;
      border: 1px solid #ccc;
      width: 220px;
      font-size: 14px;
      box-shadow: 0px 2px 6px rgba(0,0,0,0.15);
    }
  </style>

</head>
<body>

<!-- SIDEBAR -->
<div id="sidebar">
  <h2>True Place Stories</h2>

  <div class="story-item" data-id="iceage">
    <img class="story-thumb" src="windover.jpg" alt="Windover People">
    <div>
      <strong>From the Ice Age to the Space Age in Brevard County, FL</strong><br>
      Windover People · Titusville, FL
    </div>
  </div>

  <div class="story-item" data-id="flipcoin">
    <img class="story-thumb" src="FlipCoin.jpg" alt="Flip Coin Story">
    <div>
      <strong>The Coin That Flips the Super Bowl</strong><br>
      The Highland Mint · Melbourne, FL
    </div>
  </div>

  <div class="story-item" data-id="icecream">
    <img class="story-thumb" src="icecream.jpg" alt="Space Ice Cream Story">
    <div>
      <strong>The Ice Cream That Wanted to Go to Space</strong><br>
      Space Coast · Kennedy Space Center, FL
    </div>
  </div>

  <div class="story-item" data-id="tomthumb">
    <img class="story-thumb" src="TomThumb.jpg" alt="Tom Thumb Story">
    <div>
      <strong>One of America’s First Global Celebrities — General Tom Thumb</strong><br>
      Middleborough, Massachusetts
    </div>
  </div>
</div>

<!-- MAP -->
<div id="map"></div>

<!-- BEA -->
<div id="bea-message">
  <img id="bea-img" src="Otter_BEa_nov25_1.webp" alt="Bea the Otter">
  <div id="bea-text">
    Hi, I'm Bea! Tap any green lens on the map to explore a story from that place.
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
/* -----------------------------
   STORY DATA (4 locations)
------------------------------*/

const stories = [
  {
    id: "iceage",
    name: "From the Ice Age to the Space Age",
    coords: [28.613, -80.807], // Titusville
    zoom: 11
  },
  {
    id: "flipcoin",
    name: "The Coin That Flips the Super Bowl",
    coords: [28.083, -80.608], // Melbourne
    zoom: 11
  },
  {
    id: "icecream",
    name: "The Ice Cream That Wanted to Go to Space",
    coords: [28.573, -80.646], // KSC
    zoom: 11
  },
  {
    id: "tomthumb",
    name: "General Tom Thumb",
    coords: [41.893, -70.910], // Middleborough, MA
    zoom: 12
  }
];

/* -----------------------------
   MAP SETUP
------------------------------*/

const map = L.map('map').setView([28.3, -81.2], 7);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19
}).addTo(map);

/* -----------------------------
   MARKER ICONS (SMALL)
------------------------------*/

// Small scale in degrees (very tight, precise)
const SCALE_SMALL = 0.02;
const SCALE_BIG   = 0.04;

// Helper: creates bounding box around coordinate
function makeBounds(center, scale) {
  return [
    [center[0] + scale, center[1] - scale],
    [center[0] - scale, center[1] + scale]
  ];
}

const overlays = {};

// Create one overlay per story
stories.forEach(story => {
  const bounds = makeBounds(story.coords, SCALE_SMALL);

  const overlay = L.imageOverlay(
    "magnifying_gift_icon_green_transparent.png",
    bounds,
    { interactive: true }
  ).addTo(map);

  overlays[story.id] = overlay;

  overlay.on("click", () => {
    highlightStory(story.id);
  });
});

/* -----------------------------
   HIGHLIGHT + ZOOM FUNCTION
------------------------------*/

function highlightStory(id) {
  // 1) Update sidebar selection
  document.querySelectorAll(".story-item").forEach(item => {
    item.classList.toggle("active", item.dataset.id === id);
  });

  // 2) Resize overlays: selected bigger, others smaller
  stories.forEach(story => {
    const isSelected = story.id === id;
    const scale = isSelected ? SCALE_BIG : SCALE_SMALL;
    overlays[story.id].setBounds(
      makeBounds(story.coords, scale)
    );

    if (isSelected) {
      overlays[story.id].bringToFront();
    }
  });

  // 3) Center + zoom on selected place
  const match = stories.find(s => s.id === id);
  if (match) {
    map.flyTo(match.coords, match.zoom, { duration: 0.7 });
  }
}

/* -----------------------------
   SIDEBAR CLICKS
------------------------------*/

document.querySelectorAll(".story-item").forEach(item => {
  item.addEventListener("click", () => {
    highlightStory(item.dataset.id);
  });
});

// Optional: start with first story highlighted
highlightStory("iceage");
</script>

</body>
</html>
